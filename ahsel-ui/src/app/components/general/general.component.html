<div class="card" *ngIf="groupedPaymentList">
  <p-table
    #records
    [value]="groupedPaymentList"
    dataKey="id"
    [tableStyle]="{ 'min-width': '60rem' }"
    [paginator]="true"
    [rows]="10"
    [showCurrentPageReport]="true"
    currentPageReportTemplate="Gösterilen: {first} - {last}   (Toplam Kayıt:{totalRecords})"
    [rowsPerPageOptions]="[10, 25, 50]"
  >
    <ng-template pTemplate="caption">
      <div class="clearfix">
        <div class="box">
          <p-dropdown
            [options]="projectList"
            [(ngModel)]="projectRef"
            optionLabel="name"
            optionValue="id"
            appendTo="body"
            (onChange)="projectOnChange()"
          ></p-dropdown>
        </div>
        <div class="box-right">
          <button pButton pRipple icon="pi pi-plus" (click)="addOnClick()"></button>
        </div>
        <div class="box-right">
          <label for="balance">Bakiye</label>
          <input
            id="balance"
            pInputText
            class="p-inputtext p-inputtext-sm"
            style="width: 100%"
            type="text"
            ngModel="{{ totalIncome - totalExpense | number }} ₺"
          />
        </div>
        <div class="box-right">
          <label for="totalExpense">Toplam Gider</label>
          <input
            id="totalExpense"
            pInputText
            class="p-inputtext p-inputtext-sm"
            style="width: 100%"
            type="text"
            ngModel="{{ totalExpense | number }} ₺"
          />
        </div>
        <div class="box-right">
          <label>Toplam Gelir</label>
          <input
            id="totalIncome"
            pInputText
            class="p-inputtext p-inputtext-sm"
            style="width: 100%"
            type="text"
            ngModel="{{ totalIncome | number }} ₺"
          />
        </div>
      </div>
    </ng-template>
    <ng-template pTemplate="header">
      <tr>
        <th style="width: 4rem"></th>
        <th>Cari Adı</th>
        <th>Cari Toplam</th>
        <th>Ödemesi Gereken</th>
      </tr>
    </ng-template>
    <ng-template pTemplate="body" let-client let-expanded="expanded">
      <tr>
        <td>
          <button
            type="button"
            pButton
            pRipple
            [pRowToggler]="client"
            class="p-button-text p-button-rounded p-button-plain"
            [icon]="expanded ? 'pi pi-chevron-down' : 'pi pi-chevron-right'"
          ></button>
        </td>
        <td>{{ client.name }}</td>
        <td>{{ client.total | number }} ₺</td>
        <td>
          {{
            client.remainPayment == null ? "-" : (client.remainPayment | number)
          }}
          {{ client.remainPayment == null ? "" : "₺" }}
        </td>
      </tr>
    </ng-template>
    <ng-template pTemplate="rowexpansion" let-client>
      <tr>
        <td colspan="10">
          <div class="p-1">
            <p-table [value]="client.paymentList" dataKey="id">
              <ng-template pTemplate="header">
                <tr>
                  <th>Açıklama</th>
                  <th>Tarih</th>
                  <th>Miktar</th>
                  <th>Fiyat</th>
                  <th>Toplam</th>
                </tr>
              </ng-template>
              <ng-template pTemplate="body" let-payment>
                <tr>
                  <td>{{ payment.description }}</td>
                  <td>{{ payment.date | date : "dd/MM/yyyy" }}</td>
                  <td>{{ payment.quantity }}</td>
                  <td>{{ payment.price | number }} ₺</td>
                  <td>{{ payment.quantity * payment.price | number }} ₺</td>
                </tr>
              </ng-template>
            </p-table>
          </div>
        </td>
      </tr>
    </ng-template>
  </p-table>
</div>
